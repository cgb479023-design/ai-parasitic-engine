                        const reachedVisibility = await navigateToVisibility();
                        if (reachedVisibility) {
                            // --- 7. ÂèØËßÅÊÄß‰∏éË∞ÉÂ∫¶ (Visibility & Scheduling) ---
                            console.log("üëÄ Visibility Tab Reached. Mode:", (data.scheduleDate && data.scheduleTime) ? "SCHEDULE" : "PUBLIC");

                            // Ê†áËÆ∞ÊòØÂê¶ÊàêÂäüËÆæÁΩÆ‰∫ÜÂèØËßÅÊÄßÔºåÂ¶ÇÊûúÂ§±Ë¥•Âàô‰∏çËøõË°åÊúÄÂêé‰∏ÄÊ≠•
                            let visibilitySetSuccess = false;

                            if (data.scheduleDate && data.scheduleTime) {
                                // === SCHEDULE MODE (ÂÆöÊó∂ÂèëÂ∏É) ===
                                try {
                                    console.log("üïí Attempting to select Schedule mode...");
                                    
                                    // Á≠ñÁï• 1: ÈÄöËøá ID Êü•Êâæ (ÊúÄÁ®≥ÂÅ•)
                                    let scheduleRadio = document.querySelector('#schedule-radio-button');
                                    
                                    // Á≠ñÁï• 2: ÈÄöËøá name Â±ûÊÄßÊü•Êâæ (‰πãÂâçÁöÑ‰ª£Á†Å)
                                    if (!scheduleRadio) {
                                        scheduleRadio = document.querySelector('tp-yt-paper-radio-button[name="SCHEDULE"]');
                                    }

                                    // Á≠ñÁï• 3: ÈÄöËøáÊñáÊú¨ÂÜÖÂÆπÊö¥ÂäõÊü•Êâæ (ÁªàÊûÅÂÖúÂ∫ï)
                                    if (!scheduleRadio) {
                                        console.log("‚ö†Ô∏è Standard selectors failed, trying text search for 'Schedule'...");
                                        const allRadios = Array.from(document.querySelectorAll('tp-yt-paper-radio-button'));
                                        scheduleRadio = allRadios.find(el => el.textContent.trim() === 'Schedule');
                                    }

                                    if (scheduleRadio) {
                                        // ÂøÖÈ°ªÊ®°ÊãüÁÇπÂáª‰∫ã‰ª∂ÔºåÊúâÊó∂ÂçïÁ∫ØÁöÑ .click() ‰∏ç‰ºöË¢´ Polymer Ê°ÜÊû∂ÊçïËé∑
                                        scheduleRadio.click();
                                        console.log("‚úÖ Clicked Schedule radio button");
                                        visibilitySetSuccess = true;
                                        
                                        // Á≠âÂæÖÊó•ÊúüÈÄâÊã©Âô®Â±ïÂºÄ
                                        await new Promise(r => setTimeout(r, 1000));

                                        // Use pre-formatted strings from React
                                        const dateStr = data.scheduleDate;
                                        const timeStr = data.scheduleTime;

                                        // Êü•ÊâæËæìÂÖ•Ê°Ü
                                        const dateInput = document.querySelector('#datepicker-trigger input') || 
                                                        document.querySelector('ytcp-date-picker input') ||
                                                        document.querySelector('ytcp-datetime-picker .date-input input');
                                        
                                        const timeInput = document.querySelector('#time-of-day-trigger input') || 
                                                        document.querySelector('ytcp-time-picker input') ||
                                                        document.querySelector('ytcp-datetime-picker .time-input input');

                                        if (dateInput && timeInput) {
                                            console.log(`üìÖ Setting Schedule: ${dateStr} ${timeStr}`);
                                            
                                            // ËÆæÁΩÆÊó•Êúü
                                            dateInput.click();
                                            dateInput.focus();
                                            dateInput.value = '';
                                            document.execCommand('insertText', false, dateStr);
                                            dateInput.dispatchEvent(new Event('input', { bubbles: true }));
                                            dateInput.dispatchEvent(new Event('change', { bubbles: true }));
                                            dateInput.dispatchEvent(new KeyboardEvent('keydown', { key: 'Enter', keyCode: 13, bubbles: true }));
                                            await new Promise(r => setTimeout(r, 500));
                                            document.body.click(); // ÂÖ≥Èó≠ÂºπÂá∫ÁöÑÊó•ÂéÜ

                                            // ËÆæÁΩÆÊó∂Èó¥
                                            timeInput.click();
                                            timeInput.focus();
                                            timeInput.value = '';
                                            document.execCommand('insertText', false, timeStr);
                                            timeInput.dispatchEvent(new Event('input', { bubbles: true }));
                                            timeInput.dispatchEvent(new Event('change', { bubbles: true }));
                                            timeInput.dispatchEvent(new KeyboardEvent('keydown', { key: 'Enter', keyCode: 13, bubbles: true }));
                                            await new Promise(r => setTimeout(r, 500));
                                            document.body.click(); // ÂÖ≥Èó≠ÂºπÂá∫ÁöÑÊó∂Èó¥ÂàóË°®
                                        } else {
                                            console.warn("‚ö†Ô∏è Inputs for date/time not found, but 'Schedule' was selected. Video will be scheduled for default time.");
                                        }

                                    } else {
                                        throw new Error("Critical: Schedule radio button could NOT be found by any method.");
                                    }

                                } catch (e) {
                                    console.error("‚ùå Scheduling failed:", e);
                                    // Â∞ùËØïÂõûÈÄÄÂà∞ÁßÅÊúâÔºåÈÅøÂÖçÊä•Èîô
                                    console.log("‚ö†Ô∏è Fallback: Attempting to set to PRIVATE due to error.");
                                    const privateRadio = document.querySelector('tp-yt-paper-radio-button[name="PRIVATE"]');
                                    if (privateRadio) {
                                        privateRadio.click();
                                        visibilitySetSuccess = true;
                                    }
                                }

                            } else {
                                // === PUBLIC / IMMEDIATE MODE (Á´ãÂç≥ÂèëÂ∏É) ===
                                try {
                                    let publicRadio = document.querySelector('tp-yt-paper-radio-button[name="PUBLIC"]');
                                    if (!publicRadio) {
                                        // Á≠ñÁï• 2: ÊñáÊú¨Êü•Êâæ
                                        const allRadios = Array.from(document.querySelectorAll('tp-yt-paper-radio-button'));
                                        publicRadio = allRadios.find(el => el.textContent.trim().includes('Public'));
                                    }
                                    
                                    if (publicRadio) {
                                        publicRadio.click();
                                        console.log("‚úÖ Selected 'Public' visibility");
                                        visibilitySetSuccess = true;
                                    } else {
                                        console.error("‚ùå Public radio button not found");
                                    }
                                } catch (e) { console.warn("Visibility selection failed", e); }
                            }

                            // --- 8. ÂÆåÊàê (Finish) ---
                            // Âè™ÊúâÂΩìÂèØËßÅÊÄßËÆæÁΩÆÊàêÂäüÂêéÊâçÁÇπÂáª Done
                            if (visibilitySetSuccess) {
                                await new Promise(r => setTimeout(r, 2000));
                                let doneBtn = deepQuery(document.body, '#done-button');
                                
                                if (!doneBtn) {
                                    console.log("‚ö†Ô∏è '#done-button' not found, trying text search...");
                                    const buttons = Array.from(document.querySelectorAll('button, ytcp-button'));
                                    doneBtn = buttons.find(b => {
                                        const text = (b.textContent || '').trim().toLowerCase();
                                        return text === 'save' || text === 'publish' || text === 'schedule';
                                    });
                                }
                                
                                if (doneBtn) {
                                    console.log("üéâ Clicking DONE/SCHEDULE!");
                                    doneBtn.click();
                                    
                                    // Capture Link
                                    await new Promise(r => setTimeout(r, 5000));
                                    const linkEl = Array.from(document.querySelectorAll('a')).find(a => a.href && a.href.includes('youtu.be'));
                                    if (linkEl) {
                                        console.log("üöÄ RELAYING SUCCESS:", linkEl.href);
                                        chrome.runtime.sendMessage({ action: 'relayYouTubeUploadComplete', videoUrl: linkEl.href });
                                    }
                                } else {
                                     console.error("‚ùå Final Done button not found!");
                                }
                            } else {
                                console.error("üõë Upload process STOPPED because Visibility could not be set.");
                            }
                        } else {
                            console.error("‚ùå Failed to reach Visibility step.");
                        }

                        chrome.runtime.sendMessage({ action: "clearVideoData" });

                    } catch (e) {
                        console.error("‚ùå Process Upload Wizard Failed:", e);
                    }
                };
