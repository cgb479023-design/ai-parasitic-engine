# 实现“视频生成与上传”黄金功能 E2E 测试计划

## 目标
为核心的“视频生成与上传”功能闭环（黄金功能 #1a-#6）实施端到端 (E2E) 自动化测试，确保该关键用户流程的稳定性和正确性。

## 涉及的黄金功能编号
#1a-#6 (视频生成与上传相关功能)

## 步骤

### 1. 理解并分析现有“视频生成与上传”流程 (Research)
*   **读取关键文件**: 详细审查 `content.js`, `background.js`, `autoPilot.js`, `workflow.js`, `veoService.ts` 等文件，理解视频生成、API 调用和上传的逻辑。
*   **分析用户交互**: 模拟用户在浏览器中的操作路径，识别所有关键的 UI 元素、按钮点击、表单填写和页面跳转，以及相关的事件触发。
*   **F12 Console 调试指令**: 如果需要，将生成 F12 Console 调试指令，以供手动验证选择器和事件的准确性。这一步将确保后续测试脚本的稳定性和可靠性。

### 2. 搭建 E2E 测试文件结构 (Scaffold)
*   **创建新的 E2E 测试文件**: 在 `e2e` 目录下（或项目约定的 E2E 测试目录）创建 `videoGeneration.e2e.spec.ts` (或类似命名) 文件。
*   **集成 Playwright**: 确保测试环境已配置 Playwright，并且新文件能够被 `npm run verify:e2e` 命令发现并执行。

### 3. 编写 E2E 测试脚本 (Red)
*   **初始化测试**: 编写测试文件的基本结构，包括 `describe` 和 `it` 块。
*   **模拟用户操作**: 使用 Playwright API 编写脚本来模拟“视频生成与上传”的完整流程：
    *   导航到相关页面。
    *   输入必要的参数（例如，通过 `fill` 或 `type`）。
    *   点击“生成视频”按钮。
    *   等待视频生成完成（可能涉及等待网络请求或元素可见性）。
    *   点击“上传”按钮。
    *   验证上传成功提示或相关状态变化。
*   **断言失败**: 预期测试在此时会失败，因为我们尚未完全“实现”测试（或者验证应用功能）。

### 4. 调试与完善测试脚本 (Green)
*   **运行测试**: 执行 `npm run verify:e2e videoGeneration` (或 `all`) 运行新编写的 E2E 测试。
*   **定位问题**: 根据测试失败的输出、截图、视频或跟踪文件，定位是测试脚本本身的问题，还是应用中存在未预期的行为。
*   **调整脚本**: 优化选择器、等待条件和操作步骤，确保测试能够稳定、准确地模拟用户行为。如果发现应用存在 bug 或逻辑缺陷，记录下来。

### 5. 集成到项目工作流 (Integrate)
*   **更新 E2E 验证脚本**: 如果 `npm run verify:e2e` 需要更新以包含新的测试，则进行相应的修改。
*   **回归检查**: 在测试通过后，执行完整的回归检查：
    1.  `npm run snapshot create "After implementing video generation E2E test"`
    2.  `npm run verify:golden full`
    3.  `npm run verify:e2e all`
    4.  `npm run type-check`
    5.  `npm run lint`
    6.  `npm run snapshot compare`

## 风险评估
*   **选择器不稳定**: 前端 UI 变化可能导致选择器失效。计划通过使用 `data-testid` 等稳定选择器或更健壮的定位策略来缓解。
*   **异步操作和等待**: 视频生成和上传涉及异步操作，需要精确的等待策略来避免测试的 Flakiness。
*   **环境依赖**: 测试可能需要特定的测试数据或外部服务（如 Gemini API）的模拟/桩。

## 验证计划
一旦计划实施完成，将按照上述“回归检查清单”进行全面验证。
此计划完成后，将使用 `ExitPlanMode` 再次确认。

## 回滚计划
如在实施过程中遇到无法解决的问题或严重回归，将利用 `npm run snapshot restore` 恢复到最近的稳定快照。
