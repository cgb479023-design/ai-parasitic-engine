---
title: TDD工作流技能包
description: 完整的TDD工作流实现，包括测试生成、执行和验证
version: 1.0.0
author: TraeAI
tags: [tdd, testing, workflow]
---

# TDD工作流技能包

## 1. 概述

本技能包实现了完整的TDD（测试驱动开发）工作流，遵循V-Bounce变体模型，确保代码质量和可维护性。

## 2. 工作流阶段

### 阶段一：Spec生成与对齐

1. **输入**：用户需求（如"修复视频上传功能"）
2. **操作**：
   - 检索相关技能和文档
   - 生成微型规格说明书
   - 确定受影响的文件列表
   - 定义验收标准
3. **输出**：`specs/TASK_ID_spec.md`
4. **网关**：需人类开发者输入"Approved"方可进入下一阶段

### 阶段二：脚本化执行

1. **禁止**：直接在聊天框中生成500行以上的复杂逻辑代码
2. **强制**：编写或调用脚本完成任务
3. **理由**：
   - 代码是自文档化的
   - 脚本执行的变更具有原子性和可回滚性
   - 便于自动化测试和验证

### 阶段三：自动化验证

1. **质量门**：执行技能中定义的验证脚本
2. **自我修正**：
   - 读取错误日志
   - 检索故障排除文档
   - 自动修复问题
   - 再次运行测试

## 3. 脚本工具

### 3.1 测试生成脚本

**文件**：`scripts/generate-tests.ts`

**功能**：根据需求生成测试用例

**参数**：
- `--feature`: 功能描述
- `--files`: 受影响的文件列表
- `--output`: 输出目录

### 3.2 测试执行脚本

**文件**：`scripts/run-tests.ts`

**功能**：执行测试并生成报告

**参数**：
- `--test-files`: 测试文件列表
- `--reporter`: 报告格式
- `--output`: 报告输出目录

### 3.3 代码审查脚本

**文件**：`scripts/code-review.ts`

**功能**：执行代码审查，确保符合规范

**参数**：
- `--files`: 要审查的文件列表
- `--rules`: 审查规则
- `--output`: 审查报告输出目录

## 4. 验收标准

1. **测试覆盖率**：
   - 单元测试覆盖率 ≥ 80%
   - 集成测试覆盖率 ≥ 60%
   - 端到端测试覆盖率 ≥ 40%

2. **测试质量**：
   - 测试用例命名清晰
   - 测试用例相互独立
   - 测试用例包含边界条件
   - 测试用例包含错误情况

3. **测试执行**：
   - 所有测试通过
   - 测试执行时间 ≤ 30秒
   - 测试报告格式规范

4. **代码质量**：
   - 符合ESLint规范
   - 符合Prettier格式
   - 无TypeScript错误
   - 代码复杂度适中

## 5. 最佳实践

1. **先写测试**：在实现功能前先编写测试用例
2. **小步迭代**：每次只编写一个测试用例，然后实现功能
3. **测试驱动设计**：根据测试用例设计代码结构
4. **持续集成**：每次提交都运行测试
5. **定期重构**：保持代码的可维护性

## 6. 故障排除

### 6.1 测试失败

**症状**：测试用例执行失败

**解决方案**：
1. 检查测试用例逻辑
2. 检查被测试代码
3. 运行单个测试用例调试
4. 查看测试日志

### 6.2 覆盖率不足

**症状**：测试覆盖率未达到要求

**解决方案**：
1. 分析覆盖率报告
2. 补充缺失的测试用例
3. 考虑使用测试生成工具
4. 重构代码以提高可测试性

### 6.3 测试执行缓慢

**症状**：测试执行时间过长

**解决方案**：
1. 识别缓慢的测试用例
2. 优化测试数据生成
3. 考虑使用测试并行执行
4. 检查测试环境配置

## 7. 参考资料

- [TDD最佳实践](https://martinfowler.com/bliki/TestDrivenDevelopment.html)
- [Vitest文档](https://vitest.dev/)
- [React Testing Library文档](https://testing-library.com/docs/react-testing-library/intro/)
- [ESLint文档](https://eslint.org/docs/latest/)
- [Prettier文档](https://prettier.io/docs/en/)

## 8. 变更日志

### v1.0.0 (2026-01-25)
- 初始版本
- 实现完整的TDD工作流
- 包含测试生成、执行和验证脚本
- 支持Vitest测试框架
- 支持TypeScript类型检查
- 支持ESLint和Prettier代码规范检查