---
title: 完整工作流审核规范
description: 深度全面审核系统完整工作流，从Ask Studio生成计划到YouTube自动发布和评论自动化
version: 1.0.0
author: TraeAI
tags: [workflow, audit, tdd]
---

# 完整工作流审核规范

## 1. 任务概述

**任务**：深度全面审核系统完整工作流

**描述**：
1. React调用Ask Studio自动生成发布计划
2. 调用视频模型（geminigen/google vids/google flow/veo api direct）自动生成视频
3. 自动上传YouTube，填写选择相应元素
4. 等待100%上传完成，自动选择React发布计划中日期和时间设置自动发布成功到YouTube
5. 同步视频状态scheduled到React发布计划
6. 继续完成发布计划视频队列接力
7. 等待预约视频发布时间到期，同步更新视频状态为published
8. 自动开始首发视频评论与马甲评论
9. 同步评论状态到发布计划中相应视频评论状态

## 2. 受影响文件列表

### 核心组件
- `src/components/YouTubeAnalytics.tsx` - 主工作流组件

### 服务层
- `src/services/askStudioService.ts` - Ask Studio通信服务
- `src/services/yppService.ts` - 视频计划生成服务
- `src/services/youtubeService.ts` - YouTube API服务
- `src/services/youtubeApiClient.ts` - YouTube API客户端

### 技能包
- `.ai/skills/ask-studio/` - Ask Studio技能包
- `.ai/skills/video-generation/` - 视频生成技能包
- `.ai/skills/youtube-upload/` - YouTube上传技能包
- `.ai/skills/tdd-workflow/` - TDD工作流技能包

### 测试文件
- `__tests__/core-workflow.test.tsx` - 核心工作流测试

## 3. 验收标准

### 3.1 Ask Studio计划生成
- [ ] 成功调用Ask Studio API生成发布计划
- [ ] 计划数据格式正确，包含所有必要字段
- [ ] 失败时有适当的错误处理和重试机制

### 3.2 视频生成
- [ ] 支持多种视频生成模型（geminigen/google vids/google flow/veo api direct）
- [ ] 能根据计划自动生成视频
- [ ] 视频质量符合要求（分辨率≥1080p，帧率≥30fps）
- [ ] 生成失败时有适当的错误处理

### 3.3 YouTube上传
- [ ] 自动上传视频到YouTube
- [ ] 自动填写视频标题、描述、标签等元数据
- [ ] 正确处理上传进度
- [ ] 上传失败时有适当的错误处理和重试机制

### 3.4 自动发布设置
- [ ] 自动选择React发布计划中的日期和时间
- [ ] 成功设置视频为自动发布
- [ ] 同步视频状态scheduled到React发布计划

### 3.5 视频队列管理
- [ ] 支持多视频队列接力
- [ ] 自动处理下一个视频任务
- [ ] 队列状态实时更新

### 3.6 视频发布状态同步
- [ ] 检测视频发布状态变化
- [ ] 同步更新视频状态为published到React发布计划
- [ ] 触发后续评论任务

### 3.7 评论自动化
- [ ] 自动发布首发评论
- [ ] 自动发布马甲评论
- [ ] 评论内容符合计划要求
- [ ] 评论状态同步更新到发布计划

### 3.8 错误处理
- [ ] 全流程错误捕获和日志记录
- [ ] 适当的重试机制
- [ ] 用户友好的错误提示

## 4. 执行计划

### 阶段一：审核现有代码
1. 检查YouTubeAnalytics.tsx中的工作流实现
2. 审核各服务层的功能完整性
3. 检查技能包的实现是否符合SDD规范

### 阶段二：补充缺失功能
1. 实现Ask Studio服务与YouTubeAnalytics的集成
2. 完善视频生成服务的多模型支持
3. 增强YouTube上传服务的自动发布功能
4. 实现视频队列管理
5. 实现评论自动化功能

### 阶段三：编写测试用例
1. 编写核心工作流的集成测试
2. 编写各服务层的单元测试
3. 编写技能包的使用测试

### 阶段四：自动化验证
1. 运行测试用例验证功能完整性
2. 检查代码覆盖率
3. 执行代码质量检查
4. 生成验证报告

## 5. 网关条件

### 进入阶段二条件
- 现有代码审核完成
- 识别出所有缺失功能
- 获得人类开发者的"Approved"输入

### 进入阶段三条件
- 所有缺失功能实现完成
- 代码通过基本语法检查
- 获得人类开发者的"Approved"输入

### 进入阶段四条件
- 测试用例编写完成
- 测试环境配置完成
- 获得人类开发者的"Approved"输入

## 6. 交付物

1. 完整工作流实现代码
2. 测试用例集合
3. 代码质量报告
4. 功能验证报告
5. 更新后的技能包文档

## 7. 风险评估

| 风险项 | 影响程度 | 可能性 | 缓解措施 |
|--------|----------|--------|----------|
| YouTube API调用失败 | 高 | 中 | 实现重试机制和备用方案 |
| 视频生成模型不稳定 | 高 | 中 | 支持多模型切换和回退机制 |
| 发布时间同步问题 | 中 | 高 | 实现时间校准和定期检查机制 |
| 评论自动化被YouTube限制 | 中 | 低 | 实现评论频率控制和人工审核机制 |

## 8. 成功标准

1. 完整工作流能够端到端运行成功
2. 所有测试用例通过
3. 代码覆盖率≥80%
4. 无TypeScript错误
5. 符合ESLint和Prettier规范
6. 生成完整的验证报告

---

**状态**：Draft

**需要输入**：人类开发者输入"Approved"或修改建议
